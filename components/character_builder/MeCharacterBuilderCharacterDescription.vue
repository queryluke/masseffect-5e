<template>
  <div>
    <!--
    <h2 class="text-center">
      Describe Your Character
    </h2>
    <div class="d-flex mt-5">
      <div class="flex-grow-1">
        <v-text-field
          v-model="name"
          :value="name"
          outlined
          label="Name"
          @change="updateNameInPage"
        />
        <v-text-field
          v-model="image"
          :value="image"
          outlined
          label="Image URL"
        />
      </div>
      <me-character-builder-avatar
        v-if="image"
      />
    </div>
    <v-select
      :value="characteristics.alignment"
      :items="alignmentOptions"
      label="Choose an Alignment"
      @change="newAlignment => handleChangeCharacteristic('alignment', newAlignment)"
    />
    <div class="d-flex align-center">
      <v-autocomplete
        :value="background.name"
        :items="backgrounds"
        item-text="name"
        label="Choose a background"
        @change="handleChangeBackground"
      />
    </div>
    <v-select
      v-if="background || background.name === 'Custom'"
      :value="background.feat.name"
      :items="feats"
      item-text="name"
      clearable
      label="Choose a feat"
      @change="handleChangeBackgroundFeat"
    />
    <v-select
      v-if="background.name ==='Custom'"
      :value="background.feature"
      :items="feats"
      item-text="name"
      clearable
      label="Choose a background feature"
      @change="handleChangeBackgroundFeature"
    />
    <h3 class="my-3">
      Characteristics
    </h3>
    <v-text-field
      v-for="(characteristic, index) in characteristicsList"
      :key="index"
      class="mb-2"
      :value="characteristics[characteristic]"
      outlined
      hide-details
      :label="characteristic"
      @change="newCharacteristic => handleChangeCharacteristic(characteristic, newCharacteristic)"
    />
    <v-textarea
      :value="characteristics.Backstory"
      auto-grow
      label="Backstory"
      @change="newCharacteristic => handleChangeCharacteristic('Backstory', newCharacteristic)"
    />
    -->
  </div>
</template>

<script>
export default {
  data () {
    return {
      alignmentOptions: [
        'Lawful Good',
        'Neutral Good',
        'Chaotic Good',
        'Lawful Balanced',
        'Balanced Neutral',
        'Chaotic Balanced',
        'Lawful Evil',
        'Neutral Evil',
        'Chaotic Evil'
      ],
      characteristicsList: [
        'Personality Traits',
        'Ideal',
        'Bond',
        'Flaw',
        'Gender',
        'Place of Birth',
        'Age',
        'Height',
        'Weight',
        'Hair',
        'Eyes',
        'Skin',
        'Appearance'
      ]
    }
  },
  computed: {
    backgrounds () {
      const bgs = [...this.$store.getters.getData('backgrounds')]
      bgs.unshift('Custom')
      return bgs
    },
    feats () {
      return this.$store.getters.getData('feats')
    },
    background: {
      get () {
        return this.$store.getters['cb/characters'][this.$route.query.cid].character.background
      },
      set (value) {
        return this.$store.commit('cb/UPDATE_CHARACTER', { cid: this.$route.query.cid, attr: 'background', value })
      }
    },
    characteristics: {
      get () {
        return this.$store.getters['cb/characters'][this.$route.query.cid].character.characteristics
      },
      set (value) {
        return this.$store.commit('cb/UPDATE_CHARACTER', { cid: this.$route.query.cid, attr: 'characteristics', value })
      }
    },
    name: {
      get () {
        return this.$store.getters['cb/characters'][this.$route.query.cid].character.name
      },
      set (value) {
        return this.$store.commit('cb/UPDATE_CHARACTER', { cid: this.$route.query.cid, attr: 'name', value })
      }
    },
    image: {
      get () {
        return this.$store.getters['cb/characters'][this.$route.query.cid].character.image
      },
      set (value) {
        return this.$store.commit('cb/UPDATE_CHARACTER', { cid: this.$route.query.cid, attr: 'image', value })
      }
    }
  },
  methods: {
    handleChangeCharacteristic (characteristic, newCharacteristic) {
      const to = { ...this.characteristics }
      to[characteristic] = newCharacteristic
      this.characteristics = to
    },
    handleChangeBackground (newBackground) {
      this.background = { name: newBackground, feat: { name: '' }, feature: '' }
    },
    handleChangeBackgroundFeat (newFeat) {
      const to = { ...this.background }
      to.feat = { name: newFeat || '' }
      this.background = to
    },
    handleChangeBackgroundFeature (newFeature) {
      const to = { ...this.background }
      to.feature = { name: newFeature || '' }
      this.background = to
    },
    updateNameInPage (newName) {
      this.$store.commit('pageTitle', newName)
    }
  }
}
</script>
